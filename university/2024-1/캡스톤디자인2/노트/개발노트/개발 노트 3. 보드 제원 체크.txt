


지금,



인터넷을 거쳐 외부 IP를 통한 장거리 원격 제어를 성공했다.

두 개의 Wi-Fi module로 성공,
앱인벤터의 TCP/IP extension도 같은 방식이다.






이제 할 일
->
전체 시스템 점검.




arduino MEGA 보드의 PWM/타이머/인터럽트 등의 하드웨어 특성 정리.

사용하고자 하는 모듈들의 PWM/타이머/인터럽트 사용 여부 파악.




1.
arduino board의 구조를 파헤치자.



AI검색에서는,
->
어떻게 하면 PWM을 최대한 많이 사용할 수 있는가?


직접 검색에서는,
->
겉에서부터 하나하나 학습해가기.










각 타이머에는 두 개의 PWM 출력 채널이 있다.

arduino UNO
->
timer0 : pinNumber 5, 6
timer1 : 9, 10
timer2 : 11, 3

PWM을 사용하기 위해서 사실상 반드시 timer를 설정하며,
같은 timer에서 다른 PWM 출력 채널을 사용하는 서로 다른 두 개의 라이브러리는 매우 높은 확률로 충돌한다. (정확히는, 마지막에 빌드한 라이브러리가 이김.)

// 라이브러리의 boardDef.h에 정의된 대로, 보드 별로 지정된 timer와 HW적으로 연결된 PWM 핀을 사용해야 한다.



tone()은 MEGA 이외의 보드에서 timer2를 사용하고, 3, 11번 핀으로만 PWM을 출력한다.





SW PWM은 예외적인/특수한 경우로 둔다.





타이머
->
프리스케일러 일부 설정과 ICR 레지스터는 주파수(주기)를 결정하며, PWM 출력 채널은 이 주파수를 따른다.

OCR 레지스터는 PWM의 듀티 사이클을 결정한다.

8비트 해상도 타이머의 OCR 레지스터 값의 범위는 0~255,
16비트 해상도 타이머의 OCR 레지스터 값의 범위는 0~65535.



































































ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ endline
















PWM 끝났다.

이제, 대강 설계해보자.






PWM을 포함하여 모든 부품의 개별 동작에 충돌이 있어서는 안 된다.




부품을 전부 나열해보자.


ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ

2개 - DCmotor
-> 2 PWM (timer sharing)


2개 - 4선식 stepper motor
-> delay


4개 - 초음파 센서


등등...


각각의 제어 원리 및 방법을 자세하게 학습해야 한다.








통신
->
HWserial이 가능하므로, SWserial에서의 모든 interrupt 중단과 같은 걱정은 하지 않아도 된다.










ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ endline