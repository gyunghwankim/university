스테퍼 모터는 주기적으로 실행되어야 탈조가 발생하지 않으며, 주기는 1500us ~ 5000us이다.
또한 하나의 보드로 모든 부품을 구동해야 한다.
->
블로킹은 있어선 안 되고, mainLoop의 실행 시간을 최대한 단축해야 한다.
->
각 부품의 특성과 사용 방법을 데이터시트와 웹 검색으로 파악한다.





블로킹으로 인해 모든 소프트웨어 시리얼을 금지한다. (SoftwareSerial, AltSoftSerial, NeoSWSerial, ...)
이외의 라이브러리에 어떠한 블로킹이 있을지 모른다.
따라서 하드웨어 자원을 최대한 활용하고, 가능하면 직접 구현한다.
->
timer0 - clock - 건들지 않는다.

timer1 - 팬모터 (pin11, 12)

timer2 - 수동 부저 (pin9, 10)

timer(3, 4) - 스테퍼 모터(1, 2)

timer5 - RGB LED (pin44, 45, 46)








블로킹 함수
->
delay()
millis() (timer interrupt에 의존하므로, 지가 고장난다.)
pulseIn()
Serial.readStringUntil(문자 혹은 문자열)

ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ 각 함수에 대한 설명들__

delay()
->
코드를 멈춰버린다.


millis()
->
timer0 overflow interrupt를 사용 -> interrupt에 의존 -> ISR에서 사용 불가능
timer0의 현재 값을 직접 읽는 micros()를 대신 사용한다.

pulseIn()
->
초음파 센서 측정의 기본 코드로 사용된다.
작년 프로젝트에서 가장 큰 원인이었으며, 초음파 측정 거리에 따라 최대 80ms 블로킹이 발생한다.
현재 0.1초에 1회 측정하는데, 이로 인해 보드 가동 시간의 최대 80%가 블로킹 될 수 있다.
->
pulseIn() 원리에 따라 외부 인터럽트 ISR로 대신한다.


Serial.readStringUntil()
->
통신에서 주로 사용된다.
9600baudRate에서 10bytes를 수신할 때, 10.4ms가 블로킹된다.
->
10.4ms 안에서 비동기적으로 1byte씩 수신하는 것으로 변경한다.























1.
차체의 속도는, stepDelay로 봐야 한다.
현재 속도에 대한 stepDelay 범위는 1600 ~ 5000us이다.
mainLoop 실행 시간은 이를 절대 넘어선 안 된다.
->
mainLoop 실행 시간은 기본 400us, 최대 1000us 이상이 되면서, 스테퍼의 스텝 간격에 문제가 생긴다.
stepDelay(1600), mainLoopRuntime(400)
->
(1600 - 400) < stepDelay < (1600 + 400)
->
안 그래도 사용하는 스테퍼 드라이버가 기본 마이크로스텝 8이 적용된 정밀한 드라이버인데,
고속에서 불규칙한 스텝은 탈조로 인해 가장 큰 장점인 정밀도를 잃고 물리적으로 과부하/진동/소음을 유발한다.
-->
timer를 사용하기로 결정.
-->
디버깅을 마음 껏 할 수 있게 되었고, 실제 스테퍼를 가동하며 테스트할 때 디버그 코드를 제거하지 않아도 아주 잘 돌아간다.
mainLoop에 Serial 통신을 마음껏 사용할 수 있게 되었다.



1.
arduino MEGA 2560 : 6개의 timer를 가지고 있다.
->
자세한 설계는 메모장에, 뒤늦게 설계를 해보니, 6개의 타이머를 모두 사용하게 된다.
-->
하드웨어 자원을 최대한 끌어다 쓰려고 노력했다는 점으로 강조하자.



1.
모터드라이버 L298N 개쓰레기. 전압 강하 씨벌




 
1.
적외선 센서 가변 저항 돌리면서, 안정적으로 값을 인식할 수 있는 임계점으로 세팅.
// 이거는, 부품 특성 파악 부분에 들어가는 말.




ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ endline