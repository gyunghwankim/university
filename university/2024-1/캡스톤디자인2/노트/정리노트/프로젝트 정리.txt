



4학년 1학기 캡스톤디자인2 (수정 전)
->
    주제
    ->
        스마트 공기 청정기: 우선 공간을 파악하고 시간이나 먼지량에 따라 원하는 지점에서 혹은 움직이며 공기 청정 기능을 함.

        

    핵심 기술
    ->
        하나의 보드에 많은 모듈을 탑재하기 위한 HW 자원 분할.

        non-blocking 방식의 SW 구현으로 실시간 동작 및 확장성 확보.
        
        초음파 2개에 의존한 직진 주행 보정 알고리즘.

        stepper motor의 step 수를 기반으로 하여 현재 공간의 지도를 우선 작성하고, 이후에 움직이는 과정에서 step 수를 재측정하여 지도를 지속적으로 보정하고 실시간으로 차체의 위치를 계산.

        이전 캡스톤디자인에서 구현한 Wi-Fi 코드에 SW transmit buffer를 추가하여 non-blocking 방식으로 원활한 통신 구현.

        최종적으로 디버깅 LED를 제외한 모든 기능을 app으로 제어.
        
        
        

    요약
    ->
        제원
        ->
            1 arduino MEGA
            2 stepper motors
            4 ultrasonic sensors
            1 Wi-Fi module (ESP8266)
            1 dust sensor (PMS7003)
            1 fan motor
            1 gas sensor
            1 tilt sensor
            1 IR sensor (phototransistor for line-following)
            4 touch sensors

        이전에 '서빙로봇'의 주제로 자율 주행 구현에 실패한 팀에 코더로 참가했다.
        기존 팀의 차체 제작과 같은 HW 노하우에, 나만의 무선 통신과 다양한 모듈 제어와 같은 SW 노하우를 추가하여, 큰 스케일의 작품을 만들 수 있었다.

        코드의 양이 방대하기 때문에, 변수 네이밍과 모듈화에 집중하여 확장성을 챙겼고 각 기능에 대해 실행되지 않을 때는 조건 확인과 같은 필수적인 코드만 실행되도록 하여 런타임 리소스를 관리했다.



    시행 착오
    ->
        프로젝트 주제에 대해 앞으로의 설계를 잘 했다고 생각했는데, 그러지 못한 것들도 있었다.
        ->
            1.
                초기에 stepper motor를 timer로 제어하지 않고 SW로 timing을 구현했다.
                많은 기능이 stepper motor의 step 수와 보드 가동 시간을 활용했는데, timer 제어로 변경하지 않았다면 프로젝트 전체에서 큰 오차가 발생했을 것이다.
                다행히도 SW로 timing을 구현할 때 다른 작업으로 인해 모터의 동작이 지연될 경우를 대비하여 지연된 만큼 더 빠르게 동작하도록 구현한 덕분에, 초기에 문제를 발견할 수 있었다.

            2.
                시간이 촉박하다고 판단하여 분할구현을 하지 않고 하나의 소스파일로만 작업했는데, 처음부터 각 기능을 라이브러리로 분할했다면 완성도가 더 높았을 것이다.
                프로젝트 종료 이후에 일부 기능을 분할구현했다.



    팀 프로젝트로서 적을 내용
    ->
        1.
            더 완벽한 작품을 만들기 위해서.

            팀장은 팀원들과 함께 전체 그림과 차체의 기능을 설계했다.
            코딩을 어느 정도 할 줄 아는 팀장은 처음에 나와 함께 코드 작업을 했으나 실력 차이가 명백하게 드러났으며,
            함께 코드 구조를 설계하되 코드 작업을 오로지 나에게 일임하도록 팀장에게 제안함으로써 작품성과 다기능을 모두 챙길 수 있었다.



    unclassified
    ->
        ~~








4학년 1학기 캡스톤디자인2 (수정 후)
->

    기간
    ->
        2024.03 ~ 2024.06


    내용
    ->
        담당
        ->
            SW(코딩) 전담


        개요 및 구조
        ->
            움직이는 공기청정기


            제원
            ->
                1 × Arduino MEGA 개발보드
                1 × Wi-Fi 모듈 (ESP8266)
                2 × 스테퍼 모터
                4 × 초음파 센서
                1 × 먼지 센서 (PMS7003)
                1 × 팬모터
                4 × 터치 센서
                3 × 적외선 센서
                기타: LCD, 가스 센서, 기울기 센서, 부저, RGB LED, ...


            주행
            ->
                우측 2개, 전방 2개의 초음파 센서로 우측 벽을 따라 주행한다.
                부팅 시 우선 벽을 찾아가 집안을 한 바퀴 돌아 맵(스텝 수 기반)을 완성하면, App에서 공기청정 명령이 활성화된다.
                이후 명령을 수행하며 충전대를 지날 때마다 맵을 보정한다.


            App
            ->
                공기청정 명령: [특정 지점 고정 / 특정 속도로 맵 전체 순회] [특정 시간 동안] [특정 팬 모드로]
                팬 모드: [OFF, LOW, HIGH, AUTO(먼지량에 따라)] 실시간 명령 및 상태 표시, 차체의 터치센서도 동일한 인터페이스
                지도 및 차량의 실시간 위치 표시


        구현부
        ->
            단일 보드로 많은 모듈을 제어하므로, 초기부터 모든 기능을 non-blocking 방식으로 코드를 설계하고 HW 자원 분배 및 전원부 설계에 집중했다.

            통신 부분은 이전 IoT 프로젝트의 원격 제어와 코드를 확장해, App에서 실시간 명령 및 상태 확인이 가능하게 했다.

            차체 우측의 두 초음파로 '현재 기울기'와 '거리 편차'를 계산해 두 스테퍼 속도를 조정하는 것으로 직진 주행을 보정했다.


        후기
        ->
            원인 모를 HW 오작동과 차체 설계에 있어, 팀원들이 이전 프로젝트(서빙로봇)에서 얻은 노하우가 큰 도움이 됐다.
            예를 들어 모터에 가까운 전선을 2바퀴 정도 꼬아 스테퍼 모터의 오동작을 해결해 많은 시간을 단축시켰다.


            프로젝트 초기에 보드가 Wi-Fi 모듈을 통해 받는 패킷을 ASCII로 직접 확인해 구조를 완벽히 파악했다 생각했으나,
            후반 App 개발자와 함께 차체와 App 간 통신 프로토콜을 정의하는 과정에서 뒤늦게 종료 문자 관련해 문제가 발생했다.
            이를 해결하기 위해 파싱 부분에서 한 쪽의 코드 로직을 따라 반대쪽 로직을 변경해야 했는데, 조율하는 과정에서 진심으로 팀 프로젝트다운 문제 해결 및 소통을 경험했다.


            시간이 없어 최종 발표까지 C 스타일과 단일 소스로 진행했으나,
            2천 줄 이상으로 코드가 길어지자 변수 네이밍과 Arduino IDE 특성상 정의로 이동 및 수정이 힘들어 더 오래걸렸다.
            프로젝트 종료 이후 Cpp 숙달 겸 핵심 기능을 모듈화했다.


            동일 모델의 초음파 간섭은 하나씩 순차 구동으로, pulseIn() 내장 함수의 펄스 변경 대기 시간(CPU block)은 외부 인터럽트 사용으로 해결했다.
            또한 자원을 아끼고자 하나의 외부 인터럽트에 여러 echo를 연결해 동작을 실험했다.
            2개까지 안정적이었으며 4개가 아니고선 그 이상 연결할 이유가 없기에 실험을 멈췄다.
            하지만 전자과 학생으로서 오실로스코프를 사용해 회로와 신호를 직접 분석·설계할 수 있는 기회를 놓쳐 아쉽다.


        unclassified
        ->
            초음파 센서의 한계로 인해 차체는 직각으로만 움직이며, 이외의 집안 구조나 장애물은 고려하지 않았다.
            차체의 충전대는 검은색 무광 색종이로 대체하고, 차체 하단의 적외선 센서로 색종이를 인식했다.


            사용한 초음파 센서는 최장거리 혹은 측정 불가일 때 78ms로, 1초에 1cycle(4개 순차 구동)이면 무려 0.4초가 block된다.
            외부 인터럽트를 할당하더라도 1초에 2.5cycle이 최대기 때문에, 주행 반응이 좋은 편은 아니다.


            더 완벽한 작품을 만들기 위해서.
            ->
                팀장은 팀원들과 함께 전체 그림과 차체의 기능을 설계했다.
                코딩을 어느 정도 할 줄 아는 팀장은 처음에 나와 함께 코드 작업을 했으나 실력 차이가 컸다.
                그래서 함께 코드 구조를 설계하되 코드 작업을 오로지 나에게 일임하도록 팀장에게 제안함으로써 작품성과 다기능을 모두 챙길 수 있었다.





